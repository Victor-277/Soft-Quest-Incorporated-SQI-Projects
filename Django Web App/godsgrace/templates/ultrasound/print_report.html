{% extends 'ultrasound/base.html' %}
{% load static %}

{% block title %}Ultrasound Report - {{ report.patient.full_name }}{% endblock %}

{% block content %}
<style>
/* Hide everything except the report-sheet when printing */
@media print {
    body * {
        visibility: hidden; /* hide all elements */
    }
    .report-sheet, .report-sheet * {
        visibility: visible; /* show only the report */
    }
    .report-sheet {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }
    /* Hide the print button itself */
    .button {
        display: none;
    }
}
</style>


<div class="container my-5">
    <!-- Card-style container for the report -->
    <div class="report-sheet p-4 shadow-lg rounded-4 border border-light bg-white" style="max-width:900px; margin:auto;">
        <h3 class="text-center fw-bold clinic-name mb-1">
            GOD'S GRACE ULTRASOUND DIAGNOSTIC SERVICE
        </h3>
        <p class="text-center text-muted mb-3" style="font-size:0.9rem;">OJU ODO LAGBONDOKO AGUNPOPO ROAD, OYO</p>
        <hr class="mb-4">

        <!-- Patient & Report Info -->
        <div class="row mb-3">
            <div class="col-md-4"><strong>Patient:</strong> {{ report.patient.full_name }}</div>
            <div class="col-md-4"><strong>Doctor:</strong> {{ report.doctor.get_full_name }}</div>
            <div class="col-md-4"><strong>Date:</strong> {{ report.scan_date|date:"d M Y" }}</div>
        </div>

        <div class="row mb-3">
            <div class="col-md-4"><strong>Hospital:</strong> {{ report.hospital }}</div>
            <div class="col-md-4"><strong>Indication:</strong> {{ report.indication }}</div>
            <div class="col-md-4"><strong>Pregnancy Type:</strong> {{ report.pregnancy_type|title }}</div>
        </div>

        <!-- Fetal Information -->
        <h5 class="mt-4">Fetal Information</h5>
        <div class="row mb-2">
            <div class="col-md-4"><strong>Scan Type:</strong> {{ report.scan_type|title }}</div>
            <div class="col-md-4"><strong>Fetal Position:</strong> {{ report.fetal_position|title }}</div>
            <div class="col-md-4"><strong>Fetal Status:</strong> {{ report.fetal_status|title }}</div>
        </div>
        <!-- Measurements -->
        <h5 class="mt-4" style="color: #070b56;">Fetal Measurements</h5>
        <p class="small text-muted">*Values are in mm / weeks as applicable*</p>
        <table class="table table-sm table-bordered text-center align-middle">
            <tr>
                <th style="color: #070b56; background-color: #fff;">BDP (mm/weeks)</th>
                <td style="color: #070b56;">{{ report.bdp }}</td>
                <th style="color: #070b56; background-color: #fff;">CRL (mm/weeks)</th>
                <td style="color: #070b56;">{{ report.crl }}</td>
                <th style="color: #070b56; background-color: #fff;">FL (mm/weeks)</th>
                <td style="color: #070b56;">{{ report.fl }}</td>
            </tr>
            <tr>
                <th style="color: #070b56; background-color: #fff;">HC (mm/weeks)</th>
                <td style="color: #070b56;">{{ report.hc }}</td>
                <th style="color: #070b56; background-color: #fff;">AC (mm/weeks)</th>
                <td style="color: #070b56;">{{ report.ac }}</td>
                <th style="color: #070b56; background-color: #fff;">Sex</th>
                <td style="color: #070b56;">{{ report.suspected_sex }}</td>
            </tr>
            <tr>
                <th colspan="2" style="color: #070b56; background-color: #fff;">Average Fetal Age (weeks)</th>
                <td colspan="4" style="color: #070b56;">{{ report.average_fetal_age }}</td>
            </tr>
        </table>

        <!-- Placenta -->
        <h5 class="mt-4">Placenta</h5>
        <p>
            <strong>Position:</strong> {{ report.placenta_position|title }} <br>
            <strong>Maturity:</strong> {{ report.placenta_maturity|title }}
        </p>

        <!-- Cervix & Liquor -->
        <h5 class="mt-4">Cervix & Liquor</h5>
        <p>
            <strong>Distance from Cervix:</strong> {{ report.distance_from_cervix }} <br>
            <strong>Pravaria:</strong> {{ report.pravaria }} <br>
            <strong>Cervical OS:</strong> {{ report.cervical_os|title }} ({{ report.cervical_os_measurement }} mm)<br>
            <strong>Intact Cervix Length:</strong> {{ report.intact_cervix_length }}
        </p>

        <!-- Liquor & EFW -->
        <h5 class="mt-4">Liquor & EFW</h5>
        <p>
            <strong>Liquor Volume:</strong> {{ report.liquor_volume|title }} <br>
            <strong>AFI:</strong> {{ report.afi }} <br>
            <strong>EFW:</strong> {{ report.efw }}
        </p>

        <!-- Dates & Anomalies -->
        <h5 class="mt-4">Dates & Anomalies</h5>
        <p>
            <strong>USS LMP:</strong> {{ report.uss_lmp }} <br>
            <strong>EDD:</strong> {{ report.edd }} <br>
            <strong>Fetal Anomalies:</strong> {{ report.fetal_anomalies|title }}
        </p>

        <!-- Fetal Position Diagram -->
        <h5 class="mt-4">Fetal Position Diagram</h5>
        <div class="text-center mb-4">
            {% if report.fetal_position %}
                {% if report.fetal_position == 'cephalic' %}
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcmf4RV_D85IV4q0ctwQQqyi0vkFLTkAzHqw&s" alt="Cephalic Position" style="width:150px;">
                {% elif report.fetal_position == 'breech' %}
                    <img src="{% static 'images/fetal_breech.png' %}" alt="Breech Position" style="width:150px;">
                {% elif report.fetal_position == 'floating' %}
                    <img src="{% static 'images/fetal_floating.png' %}" alt="Floating / Transverse" style="width:150px;">
                {% else %}
                    <p>No fetal image available for this position</p>
                {% endif %}
            {% else %}
                <p>Fetal position not recorded</p>
            {% endif %}
        </div>

        <!-- Remarks -->
        <h5 class="mt-4">Remarks</h5>
        <p>{{ report.remarks|linebreaks }}</p>

        <div class="text-end mt-5">
            <p><strong>Signed:</strong> Signed electronically by Dr. {{ report.doctor.get_full_name }} ‚úçÔ∏è</p>
        </div>

        <p class="mt-4 small text-muted">
            Please send this report or a photocopy when requesting follow-up scans.  
            Early scans give more accurate dates than late scans.
        </p>

        <!-- Print Button -->
        <div class="text-center mt-4">
            <button onclick="window.print()" class="btn btn-secondary button">üñ®Ô∏è Print Report</button>
        </div>
    </div>
</div>
{% endblock %}

